<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/revista_lor_logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://images.pexels.com" crossorigin />
    <link rel="preconnect" href="https://jdluawvgexbygybbghmw.supabase.co" crossorigin />
    <link rel="dns-prefetch" href="https://images.pexels.com" />
    <link rel="dns-prefetch" href="https://jdluawvgexbygybbghmw.supabase.co" />

    <link rel="preload" href="/revista_lor_logo.png" as="image" />

    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" media="print" onload="this.media='all'" />
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" /></noscript>
    <script type="module">
      const CACHE_KEY = 'revista_hero_articles';
      const CACHE_DURATION = 5 * 60 * 1000;
      const HERO_LIMIT = 9;

      const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
      const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;
      const heroEndpoint =
        supabaseUrl &&
        `${supabaseUrl}/rest/v1/articles?select=id,title,slug,category,author,image_url,published_at&order=published_at.desc&limit=${HERO_LIMIT}`;

      const formatDate = (value) =>
        new Date(value).toLocaleDateString('ro-RO', {
          day: 'numeric',
          month: 'long',
          year: 'numeric'
        });

      const getPlaceholderDataUrl = (url) => {
        if (!url) return undefined;
        const baseUrl = url.split('?')[0];
        if (url.includes('pexels.com')) {
          return `${baseUrl}?auto=compress&cs=tinysrgb&w=32&q=12&blur=40&fm=webp`;
        }
        if (url.includes('unsplash.com')) {
          return `${baseUrl}?w=32&q=12&auto=format&blur=40`;
        }
        return undefined;
      };

      const optimizeHeroUrl = (url) => {
        if (!url) return null;
        const baseUrl = url.split('?')[0];

        if (url.includes('pexels.com')) {
          return `${baseUrl}?auto=compress&cs=tinysrgb&w=1400&q=82&fm=webp`;
        }

        if (url.includes('unsplash.com')) {
          return `${baseUrl}?w=1400&q=82&auto=format`;
        }

        return url;
      };

      const hasFreshCache = () => {
        try {
          const cached = localStorage.getItem(CACHE_KEY);
          if (!cached) return false;

          const { timestamp } = JSON.parse(cached);
          const isFresh = Date.now() - timestamp < CACHE_DURATION;

          if (isFresh && !window.__REVISTA_HERO_PREFETCH__) {
            window.__REVISTA_HERO_PREFETCH__ = JSON.parse(cached);
          }

          return isFresh;
        } catch (error) {
          console.warn('Hero cache not available', error);
          return false;
        }
      };

      const cacheArticles = (data) => {
        try {
          const articles = data.map((article) => ({
            id: article.id,
            title: article.title,
            category: article.category,
            author: article.author,
            date: formatDate(article.published_at),
            imageUrl: article.image_url,
            slug: article.slug,
            placeholderDataUrl: getPlaceholderDataUrl(article.image_url)
          }));

          const payload = {
            articles,
            timestamp: Date.now()
          };

          localStorage.setItem(CACHE_KEY, JSON.stringify(payload));
          window.__REVISTA_HERO_PREFETCH__ = payload;
          window.dispatchEvent(new CustomEvent('revista:hero-prefetched', { detail: payload }));

          const heroImage = optimizeHeroUrl(articles[0]?.imageUrl);
          if (heroImage && !document.querySelector('link[data-hero-preload]')) {
            const preload = document.createElement('link');
            preload.rel = 'preload';
            preload.as = 'image';
            preload.href = heroImage;
            preload.fetchPriority = 'high';
            preload.setAttribute('data-hero-preload', 'true');
            document.head.appendChild(preload);
          }
        } catch (error) {
          console.warn('Hero cache skipped', error);
        }
      };

      async function preloadHero() {
        if (!heroEndpoint || !supabaseAnonKey || hasFreshCache()) return;

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 2500);

        try {
          const response = await fetch(heroEndpoint, {
            headers: {
              apikey: supabaseAnonKey,
              Authorization: `Bearer ${supabaseAnonKey}`
            },
            signal: controller.signal,
            cache: 'no-store'
          });

          if (!response.ok) return;

          const data = await response.json();
          if (Array.isArray(data) && data.length) {
            cacheArticles(data);
          }
        } catch (error) {
          console.warn('Hero preload failed', error);
        } finally {
          clearTimeout(timeoutId);
        }
      }

      preloadHero();
    </script>
    <title>Revista LOR - Lifestyle, Fashion & Beauty</title>
    <meta name="description" content="Portal de lifestyle, fashion, beauty, cultura si stiri. Inspiratie zilnica pentru femei moderne." />
    <meta name="keywords" content="revista, lifestyle, fashion, beauty, cultura, stiri, femei, Romania" />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://stunning-gingersnap-968e68.netlify.app/" />
    <meta property="og:title" content="Revista LOR - Lifestyle, Fashion & Beauty" />
    <meta property="og:description" content="Portal de lifestyle, fashion, beauty, cultura si stiri. Inspiratie zilnica pentru femei moderne." />
    <meta property="og:image" content="https://stunning-gingersnap-968e68.netlify.app/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:site_name" content="Revista LOR" />
    <meta property="og:locale" content="ro_RO" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://stunning-gingersnap-968e68.netlify.app/" />
    <meta name="twitter:title" content="Revista LOR - Lifestyle, Fashion & Beauty" />
    <meta name="twitter:description" content="Portal de lifestyle, fashion, beauty, cultura si stiri. Inspiratie zilnica pentru femei moderne." />
    <meta name="twitter:image" content="https://stunning-gingersnap-968e68.netlify.app/og-image.png" />
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
